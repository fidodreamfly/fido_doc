<html>
<head>
  <title>Evernote Export</title>
  <basefont face="微软雅黑" size="2" />
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="exporter-version" content="Evernote Windows/272632; Windows/6.1.7600;"/>
  <style>
    body, td {
      font-family: 微软雅黑;
      font-size: 10pt;
    }
  </style>
</head>
<body>
<a name="701"/>

<div>
<div style="word-wrap: break-word; -webkit-nbsp-mode: space; -webkit-line-break: after-white-space;"><div style="font-size: 23px;"><font color="#E30000">Q:1.ASM 传递给认证器的信息中TAG_KEYHANDLE_ACCESS_TOKEN 是怎样生成的？有什么作用？</font></div><div style="font-size: 23px;"><font color="#2D4FC9"><br/></font></div><div style="font-size: 23px;">A：关于这个字段的组成:文档里面的注释有：</div><div style="font-size: 23px;">    <img src="Fido Q&A_files/7.png" type="image/png" height="483" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1314"/></div><div style="widows: 1;font-size: 23px;">  这个字段是由AppId,  PersonID，ASMToken，CallerId组成的。</div><div style="widows: 1;font-size: 23px;">  关于这个字段的作用：文档中也有:</div><div style="widows: 1;font-size: 23px;">  <img src="Fido Q&A_files/8.png" type="image/png" height="413" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;" width="1240"/></div><div style="widows: 1;font-size: 23px;">    第一次注册的过程中，这个信息会被加入KeyHandle里面。然后在每一次认证使用的时候，ASM都会重新生成KeyHandleAccessToken，认证器将之后收到的KeyHandle的信息中的KeyHandleAccessToken和重新生成的这个KeyHandleAccessToken的摘要信息进行摘要算法比较，相等才会认为ASM是可靠的。</div><div style="widows: 1;font-size: 23px;"><br/></div><div style="widows: 1;font-size: 23px;"><font color="#E30000">Q：在注册的过程中，认证器返回X509证书的作用是？</font></div><div style="widows: 1;font-size: 23px;">A：X509证书是在认证器里面的，X509证书最后会发给服务器，fido服务器会检查这个证书是否是有效的，如果是有效的，则会告诉用户，注册是成功的。</div><div style="widows: 1;font-size: 23px;"><br/></div><div style="widows: 1;font-size: 23px;"><font color="#E30000">Q: 认证器的类型有哪些？</font></div><div style="widows: 1;font-size: 23px;">A：(密码因子数目和是否绑定设备)两两组合，有四种类型。最大的区别就是是否存储KeyHandle</div><div style="widows: 1;font-size: 23px;"><br/></div><div style="widows: 1;font-size: 23px;"><font color="#E30000">Q: ASM和认证器交互的过程中，如何去识别用户的身份的？（比如用户的指纹作为密码，如果支付的时候，用户变成了其他人，又识别用户是不正确的呢？）</font></div><div style="widows: 1;font-size: 23px;">A：文档的截图中有这样一段话：</div><div style="widows: 1;font-size: 23px;">   <img src="Fido Q&A_files/Image.png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div style="widows: 1;font-size: 23px;">也就是说，ASM在向认证器做数据传递的过程之前，认证器就会去识别用户的身份了，而且如果认证器支持的话，应该会产生一个TAG_USERVERIFY_TOKEN的字段，ASM在认证成功后，会向认证器发送。所以认证器应该是通过模式识别等技术来校验用户的身份。</div><div style="widows: 1;font-size: 23px;"><br/></div><div style="widows: 1;font-size: 23px;"><font color="#E30000">Q:KeyHandle的关键作用是什么？</font></div><div style="widows: 1;font-size: 23px;"><a href="file:///A:我们首先了解KeyHandle在文档中的官方介绍：">A:我们首先了解KeyHandle在文档中的官方介绍：</a></div><div style="widows: 1;font-size: 23px;">  <img src="Fido Q&A_files/Image [1].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div style="widows: 1;font-size: 23px;">    KeyHandle是由KHAcessToken和认证器的私钥以及用户名组成（其中用户名是区分一因子和二因子认证器最关键区别）。因为二因子的认证器（其实类似于银行U盾）已经在验证的时候输入了帐号和密码了，而一因子的认证器却没有，所以，一因子的认证器需要将UserName放在KeyHandle里面。</div><div style="widows: 1;font-size: 23px;">    KeyHandle的作用有一下几个关键点：</div><div style="widows: 1;font-size: 23px;">    1.放置认证器生成的私钥，用于在服务器认证的过程中，签名服务器的挑战信息，然后返回给服务器做验证签名的信息，如果验证通过，说明了用户确实可以信任。</div><div style="widows: 1;font-size: 23px;">    2.KeyHandle中的UserName也是认证用户的关键点之一</div><div style="widows: 1;font-size: 23px;">    3.KeyHandle中的KeyAcessToken也是认证器信任ASM的关键点（KeyAcessToken的回答中有提到）</div><div style="widows: 1;font-size: 23px;">   </div><div style="widows: 1;font-size: 23px;"><div><a href="file:///Q:KeyId和KeyHandle的作用是什么？"><font color="#FF7A74">Q:KeyId和KeyHandle的</font></a><font color="#E30000">的关系是什么？KeyId有什么作用？</font></div><div>A：什么是KeyId的呢？我们首先要搞清楚KeyId是什么？文档的官方解释为:</div><div>  <img src="Fido Q&A_files/Image [2].png" type="image/png" style="cursor: default;cursor: default;cursor: default;cursor: default;"/></div><div>     KeyId是认证器一串随机生成的数字，有什么作用呢？KeyId是用来寻找KeyHandle的。为什么这样说呢？</div><div>    我们先从注册的官方文档上看一看吧。</div><div>    首先，对应绑定类认证器而言：</div><div>    <img src="Fido Q&A_files/Image [3].png" type="image/png" style="cursor: default;cursor: default;cursor: default;"/></div><div>    ASM在得到认证器返回的要的认证器返回的信息之后，会拿出KeyId的，如果是绑定型认证器的话，会存储callerID，AppId，KeyHandle，KeyId进入数据库。</div><div>   之后在验证的过程中：</div><div>    <img src="Fido Q&A_files/Image [4].png" type="image/png" style="cursor: default;cursor: default;cursor: default;"/></div><div>    ASM会根据服务器的KeyId从数据库中查找得到对应的keyHandle,返回发给认证器。</div><div>   2.对应非绑定类的认证器而言：</div><div>    <img src="Fido Q&A_files/Image [5].png" type="image/png" style="cursor: default;cursor: default;"/></div><div>     对应非绑定类型的认证器而言，KeyHandle是存储在认证器内部的，ASM只是给KeyId给认证器，由认证器来实现KeyId到KeyHandle的寻找和提取。</div><div>     所以，我们可以看到，KeyId的作用就是用于提取KeyHandle的。</div><div><span style="color: rgb(227, 0, 0); widows: 2;">Q:KeyId如果是一串随机的数字，那么，KeyHandle重复了怎么办？</span></div><div style="widows: 2;">A：1.首先，文档中说明，如果为绑定类型的认证器，ASM是根据KeyId和AppId来共同寻找对应的KeyHandle</div><div style="widows: 2;">     2.<img src="Fido Q&A_files/Image [6].png" type="image/png" style="cursor: default;"/></div><div style="widows: 2;">      认证器自己也会通过KeyAccessToken来过滤掉不合适的KeyHandle，找出自己对应的KeyHandle</div><div style="widows: 2;">    </div><div style="widows: 2;"><font color="#DE5700">Q：AppId用什么作用</font></div><div style="widows: 2;">A:  区别不一样的应用程序对应的fido认证KeyHandle（比如支付宝和京东钱包）</div><div style="widows: 2;"><br/></div><div>      </div><div>   </div><div>    </div><div><br/></div></div><div style="widows: 1;font-size: 23px;"><br/></div><div style="widows: 1;font-size: 23px;">  </div></div>
</div></body></html> 